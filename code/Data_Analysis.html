

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Data Analysis &#8212; Research Internship - Functional Connectivity in Patients with ADHD</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'code/Data_Analysis';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Evaluation and Discussion of the Results" href="Discussion.html" />
    <link rel="prev" title="Data Exploration" href="Data_Exploration.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../general_information/index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../general_information/index.html">
                    Welcome!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Literature_Review.html">Introduction and Conception of the Research Question</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data_and_Projectmanagement.html">Data- and Projectmanagement</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data_Exploration.html">Data Exploration</a></li>



<li class="toctree-l1 current active"><a class="current reference internal" href="#">Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="Discussion.html">Evaluation and Discussion of the Results</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/nwiltberg/project_msc05/main?urlpath=tree/content/code/Data_Analysis.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/nwiltberg/project_msc05" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/nwiltberg/project_msc05/edit/main/content/code/Data_Analysis.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/nwiltberg/project_msc05/issues/new?title=Issue%20on%20page%20%2Fcode/Data_Analysis.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/code/Data_Analysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Data Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-data">0. Recap Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-time-series">1. Extracting time series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-and-display-correlation-matrix-for-one-participant">2. Compute and display correlation matrix for one participant</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-time-series-and-compute-connectome-for-all-participants">3. Extract time series and compute connectome for all participants</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supervised-learning-algorithm">4. Supervised learning algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unsupervised-learning-algorithm">5. Unsupervised learning algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#more-data-from-brainlife">6. More Data from brainlife</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-authorization-token">Load authorization token</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-object-ids">Load object ids</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-subject-ids">Load subject ids</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#link-object-and-subject-ids">Link object and subject ids</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attempt-to-load-file-for-one-subject">Attempt to load file for one subject</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="data-analysis">
<h1>Data Analysis<a class="headerlink" href="#data-analysis" title="Permalink to this heading">#</a></h1>
<p>In this section, the various steps of the data analysis are described. More details on loading the data and exploring it can be found in the section “data exploration”.</p>
<p>Then the functional connectomes for the regions of interests are computed. For this purpose, the time series underlying the functional connnectome are extracted first. These time series represent the measurement points of activity over time. After extracting them for each brain region of the chosen cerebral parcellation, the correlation for all pairs of the parcels are calculated.</p>
<p>In a next step, a supervised learning algorithm is used to test if it is possible to predict the diagnosis of a subject based on its functional connectome. Subsequently, an unsupervised learning algorithm is used to to cluster the data into subgroupes regardless of the diagnosis of the subjects. Based on the discussion in the literature review section, it is expected that the subtypes of ADHD can be predicted using the functional connectomes. In addition, it is assumed that the clustering also fits the classification of the subjects in terms of their diagnosis.</p>
<section id="recap-data">
<h2>0. Recap Data<a class="headerlink" href="#recap-data" title="Permalink to this heading">#</a></h2>
<p>First, the required modules have to be imported and the dataset has to be reloaded. More information on loading the data and the data set can be found in the notebook about data exploration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nilearn</span>
<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">nilearn.maskers</span> <span class="kn">import</span> <span class="n">NiftiLabelsMasker</span>
<span class="kn">from</span> <span class="nn">nilearn.connectome</span> <span class="kn">import</span> <span class="n">ConnectivityMeasure</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the open data set ADHD 200 from nilearn</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">nilearn</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">fetch_adhd</span><span class="p">(</span><span class="n">n_subjects</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;/mnt/c/Users/nasta/Desktop/Forschungsmodul/project_msc05/data&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/nwiltberg/miniconda3/envs/neuro_ai/lib/python3.7/site-packages/nilearn/datasets/func.py:251: VisibleDeprecationWarning:

Reading unicode strings without specifying the encoding argument is deprecated. Set the encoding, use None for the system default.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/mnt/c/Users/nasta/Desktop/Forschungsmodul/project_msc05/data/adhd/data/0010042/0010042_rest_tshift_RPI_voreg_mni.nii.gz&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;func&#39;, &#39;confounds&#39;, &#39;phenotypic&#39;, &#39;description&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;confounds&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/mnt/c/Users/nasta/Desktop/Forschungsmodul/project_msc05/data/adhd/data/0010042/0010042_regressors.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">nasta</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">Forschungsmodul</span><span class="o">/</span><span class="n">project_msc05</span><span class="o">/</span><span class="n">data</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/mnt/c/Users/nasta/Desktop/Forschungsmodul/project_msc05/data
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pheno_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;adhd200_preprocessed_phenotypics.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pheno</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;adhd/pheno_final.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="extracting-time-series">
<h2>1. Extracting time series<a class="headerlink" href="#extracting-time-series" title="Permalink to this heading">#</a></h2>
<p>The dataset contains resting state fmri data. In fmri, for each voxel in the brain the activity over time is being measured resulting in so called time series. These activation time-series are needed to compute a functional connectome, a set of connections representing brain interactions between regions. So they have to be extracted first. This is initially carried out for one participant as an example.</p>
<p>With the following code, the variables needed for the extraction are set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rest_files</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">confound_files</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;confounds&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>As already mentioned in the notebook ‘data exploration’, the Yeo atlas is being used for brain parcellation. Since the parcelling is to be used to calculate the connectivity between the different regions, the altas must also be loaded here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atlas_yeo</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_atlas_yeo_2011</span><span class="p">(</span><span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;/mnt/c/Users/nasta/Desktop/Forschungsmodul/project_msc05/data/yeo_atlas&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atlas_file</span> <span class="o">=</span> <span class="n">atlas_yeo</span><span class="o">.</span><span class="n">thick_7</span>
</pre></div>
</div>
</div>
</div>
<p>Now, the <a class="reference external" href="https://nilearn.github.io/dev/modules/generated/nilearn.maskers.NiftiLabelsMasker.html">‘NiftiLabelsMasker’</a> from nilearn is being used to extract the signals on the parcellation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">masker</span> <span class="o">=</span> <span class="n">NiftiLabelsMasker</span><span class="p">(</span><span class="n">labels_img</span><span class="o">=</span><span class="n">atlas_file</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="s1">&#39;nilearn_cache&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With ‘fit_transform’ the Nifti data is now turned to time-series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_series</span> <span class="o">=</span> <span class="n">masker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">rest_files</span><span class="p">,</span> <span class="n">confounds</span><span class="o">=</span><span class="n">confound_files</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s evaluate the shape of the variable time_series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_series</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(176, 7)
</pre></div>
</div>
</div>
</div>
<p>This shows that the variable contains 176 time points for the 7 extracted networks. So far, the variable only contains two dimensions. Later we need the time series stacked across participants (participants x time x regions). To reshape the time series we could do the following to introduce a respective new dimension.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_series</span> <span class="o">=</span> <span class="n">time_series</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">176</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="n">time_series</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[[-0.51034445, -0.29479277, -1.6705873 , ...,  0.28058898,
         -0.71294105,  0.22904894],
        [ 0.9958635 , -0.3302702 , -0.40546834, ..., -0.90956265,
         -0.2500286 , -0.2580618 ],
        [ 1.7991178 , -2.5736818 ,  0.18031912, ..., -0.574182  ,
         -0.01597627, -0.85473424],
        ...,
        [ 0.7255313 , -1.2795805 ,  0.43343168, ..., -0.40040085,
          0.865115  ,  0.51268786],
        [ 2.5853388 , -1.439889  ,  1.5045828 , ..., -1.1568449 ,
          1.2774026 , -0.49751338],
        [ 2.8541226 , -1.6701623 ,  0.60753673, ..., -0.2558145 ,
         -0.25552046, -1.1211945 ]]], dtype=float32)
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-and-display-correlation-matrix-for-one-participant">
<h2>2. Compute and display correlation matrix for one participant<a class="headerlink" href="#compute-and-display-correlation-matrix-for-one-participant" title="Permalink to this heading">#</a></h2>
<p>To compute the connectivity of regions across time points, the connectivity measure must be defined first. In this project correlation is used as a widespread and simple method of parametrization. In the next step the correlation matrix is computed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">connectome_measure</span> <span class="o">=</span> <span class="n">ConnectivityMeasure</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;correlation&#39;</span><span class="p">)</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">connectome_measure</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">time_series</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The computed correlation matrix still has extra dimension added above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correlation_matrix</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1, 7, 7)
</pre></div>
</div>
</div>
</div>
<p>As we work with data of one participant right now, lets just drop it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">correlation_matrix</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(7, 7)
</pre></div>
</div>
</div>
</div>
<p>With the following command, we can have a closer look at the correlation matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correlation_matrix</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.        , -0.5145971 ,  0.16595417, -0.4575826 , -0.15901949,
        -0.32257894, -0.16459793],
       [-0.5145971 ,  1.        , -0.15548664,  0.64208764,  0.10796294,
         0.07630513, -0.19502069],
       [ 0.16595417, -0.15548664,  1.        , -0.11649854, -0.01312734,
         0.06357163, -0.29489803],
       [-0.4575826 ,  0.64208764, -0.11649854,  1.        ,  0.03280948,
         0.24299005, -0.45543557],
       [-0.15901949,  0.10796294, -0.01312734,  0.03280948,  1.        ,
        -0.04724521,  0.05450457],
       [-0.32257894,  0.07630513,  0.06357163,  0.24299005, -0.04724521,
         1.        , -0.07549269],
       [-0.16459793, -0.19502069, -0.29489803, -0.45543557,  0.05450457,
        -0.07549269,  1.        ]], dtype=float32)
</pre></div>
</div>
</div>
</div>
<p>Now the correlation matrix should be plotted. <a class="reference external" href="https://nilearn.github.io/dev/modules/generated/nilearn.plotting.plot_matrix.html#nilearn.plotting.plot_matrix">Nilearn’s plot_matrix</a> is used for this.</p>
<p>In the first step, the corresponding module is imported.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>
<span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="kn">import</span> <span class="n">plot_matrix</span>
</pre></div>
</div>
</div>
</div>
<p>Then the labels provided in the atlas used for brain parcellation are extracted to be able to use them for plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">atlas_yeo</span><span class="o">.</span><span class="n">colors_7</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="s1">&#39;Unnamed: 7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s plot the connectivity matrix. To make the figure easier to understand, we set the diagonal to 0. Otherwise the matrix would contain a 1 here, since it corresponds to the correlation of a network with itself.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_matrix</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fd8967b3fd0&gt;
</pre></div>
</div>
<img alt="../_images/ea7b15250e6aa630ac310e6eb2d0a9cec8a08fde215f6c6b1c583af1610fc50d.png" src="../_images/ea7b15250e6aa630ac310e6eb2d0a9cec8a08fde215f6c6b1c583af1610fc50d.png" />
</div>
</div>
<p>As expected, the plot shows us clearly that the matrix is symmetric. It contains the same values in the upper triangle as in the lower one because every correlation of the timeseries of two networks is included twice. For the further procedure, however, it is important that values are not taken into account twice. For now, let’s just plot the lower triangle of the matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotting</span><span class="o">.</span><span class="n">plot_matrix</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fd896611e80&gt;
</pre></div>
</div>
<img alt="../_images/c5d1fa824a06bf518c662626ef0a06312d6d34cac4c957166698306673bc327f.png" src="../_images/c5d1fa824a06bf518c662626ef0a06312d6d34cac4c957166698306673bc327f.png" />
</div>
</div>
</section>
<section id="extract-time-series-and-compute-connectome-for-all-participants">
<h2>3. Extract time series and compute connectome for all participants<a class="headerlink" href="#extract-time-series-and-compute-connectome-for-all-participants" title="Permalink to this heading">#</a></h2>
<p>After we have looked at the previous steps for one participant as an example, the procedure should be repeated for the entire dataset. So at first, the time series from all subjects need to be extracted and concatenated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_series</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">confounds</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">confounds</span><span class="p">):</span>
    <span class="n">time_series</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">masker</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">confounds</span><span class="o">=</span><span class="n">confounds</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now the correlation matrices across all subjects can be calculated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correlation_matrices</span> <span class="o">=</span> <span class="n">connectome_measure</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">time_series</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When evaluating the shape of the correlation matrices, we can see that it now contains the third dimension described above. It shows us that the calculation worked for all 40 participants.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">correlation_matrices</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(40, 7, 7)
</pre></div>
</div>
</div>
</div>
<p>Now a glass brain plot will be used to visualize the connectome. This requires choosing centers for each network of the atlas used for brain parcellation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">find_parcellation_cut_coords</span><span class="p">(</span><span class="n">labels_img</span><span class="o">=</span><span class="n">atlas_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the next step, the mean correlation matrix across all subjects is computed for plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_correlation_matrix</span> <span class="o">=</span> <span class="n">connectome_measure</span><span class="o">.</span><span class="n">mean_</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the mean connectome on the glass brain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotting</span><span class="o">.</span><span class="n">plot_connectome</span><span class="p">(</span><span class="n">mean_correlation_matrix</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span>
                         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Yeo Atlas 7 thick (func)&#39;</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;nilearn.plotting.displays._projectors.OrthoProjector at 0x7fd896534a58&gt;
</pre></div>
</div>
<img alt="../_images/0e43f5fa1d9016309672ef61a86c90815708fd9b046d092615db26908852d8eb.png" src="../_images/0e43f5fa1d9016309672ef61a86c90815708fd9b046d092615db26908852d8eb.png" />
</div>
</div>
<p>At this point it is important to note that the Yeo atlas does not only contain networks in the left hemisphere, as it first appears. But the seven networks cover larger areas in the left than in the right hemisphere. So the center of each of them lies in the left hemisphere. The visualization of the parcellation can be viewed in the notebook ‘data exploration’.</p>
<p>Now the mean correlation matrix is plotted in the same way as described above for a subject.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">mean_correlation_matrix</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">plot_matrix</span><span class="p">(</span><span class="n">mean_correlation_matrix</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7fd895bb7518&gt;
</pre></div>
</div>
<img alt="../_images/8bbd21438418ece02c37b9b675908f29a6b3e017c5d6ea27edd12fe45e12d52e.png" src="../_images/8bbd21438418ece02c37b9b675908f29a6b3e017c5d6ea27edd12fe45e12d52e.png" />
</div>
</div>
<p>At this point the connectomes are stored in a matrix for each subject containing 7 x 7 measures. To be able to pass the connectivity measures to a supervised learning algorithm, we must format them in a way that we get a vector for each participant containing the correlations between the time series of each network with one of the other six networks. So the vector should contain 21 measures for each subject. The following command returns the flattened lower triangular part of our matrix. The diagonal is discarded. Let’s store this in a new variable called ‘connectome_vect’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">connectome_vect</span><span class="o">=</span><span class="n">nilearn</span><span class="o">.</span><span class="n">connectome</span><span class="o">.</span><span class="n">sym_matrix_to_vec</span><span class="p">(</span><span class="n">correlation_matrices</span><span class="p">,</span> <span class="n">discard_diagonal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="supervised-learning-algorithm">
<h2>4. Supervised learning algorithm<a class="headerlink" href="#supervised-learning-algorithm" title="Permalink to this heading">#</a></h2>
<p>In the next steps, the functional connectivity computed above will be used to discriminate between the different groups of diagnosis regarding ADHD (no ADHD, ADHD-Combined, ADHD-Hyperactive/Impulsive and ADHD-Inattentive) and to predict them.</p>
<p>The phenotypic file loaded above contains the diagnostic information in the column ‘DX’. Which number stands for which diagnosis can be found out <a class="reference external" href="http://fcon_1000.projects.nitrc.org/indi/adhd200/general/ADHD-200_PhenotypicKey.pdf">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">pheno</span><span class="p">[</span><span class="s1">&#39;DX&#39;</span><span class="p">]</span>
<span class="n">classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
<span class="n">groups</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1
1    1
2    0
3    0
4    0
5    1
6    1
7    1
8    1
9    1
Name: DX, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>To ensure that the participants are evenly distributed across the groups, this distribution is now plotted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">diagnosis</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">diagnosis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Distribution of Groups&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of Subjects&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
    <span class="n">y_value</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
    <span class="n">x_value</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">space</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">label</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">y_value</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">x_value</span><span class="p">,</span> <span class="n">y_value</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">space</span><span class="p">),</span> <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/34bc27527bcd55cf6f24355f47b9218efa68f085a5d7f17778c8f738f2a16973.png" src="../_images/34bc27527bcd55cf6f24355f47b9218efa68f085a5d7f17778c8f738f2a16973.png" />
</div>
</div>
<p>The plot shows that there is no even distribution and the diagnosis with the number 2 does not even occur in the data set used here.</p>
<p>For the further steps we need the group variable in a np.array format. So, it is now formatted accordingly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, cross-validation is used to compare the connectomes across the groups and check the predictive power. For this purpose, the participants will be assigned to training and test sets using a <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.StratifiedKFold.html">StratifiedKFold</a>. The folds are made by preserving the percentage of samples for each class. Let’s do this for 10 folds. Afterwards, lets’s have a look at the splits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">skf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">connectome_vect</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TRAIN:&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="s2">&quot;TEST:&quot;</span><span class="p">,</span> <span class="n">groups</span><span class="p">[</span><span class="n">test_index</span><span class="p">])</span>
    <span class="n">groups_train</span><span class="p">,</span> <span class="n">groups_test</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">groups</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TRAIN: [0 1 1 1 1 1 3 3 0 0 3 0 0 1 1 1 0 3 1 1 0 0 0 0 0 1 0 0 0 3 0 0 0 1 1 0] TEST: [1 1 0 0]
TRAIN: [1 1 0 0 1 1 1 3 3 0 3 0 0 1 1 1 0 3 1 1 0 0 0 0 0 1 0 0 0 3 0 0 0 1 1 0] TEST: [0 1 1 0]
TRAIN: [1 1 0 0 0 1 1 1 3 3 0 3 0 1 1 1 0 3 1 1 0 0 0 0 0 1 0 0 0 3 0 0 0 1 1 0] TEST: [1 1 0 0]
TRAIN: [1 1 0 0 0 1 1 1 1 3 3 0 0 3 0 1 1 3 1 1 0 0 0 0 0 1 0 0 0 3 0 0 0 1 1 0] TEST: [1 0 1 0]
TRAIN: [1 1 0 0 0 1 1 1 1 1 3 3 0 0 3 0 0 1 0 3 1 1 0 0 0 1 0 0 0 3 0 0 0 1 1 0] TEST: [1 1 0 0]
TRAIN: [1 1 0 0 0 1 1 1 1 1 3 0 0 3 0 0 1 1 1 0 3 1 0 0 0 1 0 0 0 3 0 0 0 1 1 0] TEST: [3 1 0 0]
TRAIN: [1 1 0 0 0 1 1 1 1 1 3 0 0 3 0 0 1 1 1 0 3 1 0 0 0 0 1 0 0 3 0 0 0 1 1 0] TEST: [3 1 0 0]
TRAIN: [1 1 0 0 0 1 1 1 1 1 3 3 0 0 0 0 1 1 1 0 3 1 1 0 0 0 0 0 0 3 0 0 0 1 1 0] TEST: [3 1 0 0]
TRAIN: [1 1 0 0 0 1 1 1 1 1 3 3 0 0 3 0 0 1 1 1 0 1 1 0 0 0 0 0 1 0 0 0 3 0 1 0] TEST: [3 0 0 1]
TRAIN: [1 1 0 0 0 1 1 1 1 1 3 3 0 0 3 0 0 1 1 1 0 3 1 1 0 0 0 0 0 1 0 0 0 0 0 1] TEST: [3 0 1 0]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/nwiltberg/miniconda3/envs/neuro_ai/lib/python3.7/site-packages/sklearn/model_selection/_split.py:680: UserWarning:

The least populated class in y has only 5 members, which is less than n_splits=10.
</pre></div>
</div>
</div>
</div>
<p>In the next step, ‘cross_val_predict’ is used to generate predictions each iteration. <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.LinearSVC.html">‘LinearSCV’</a> will be set as estimator, which stands for Linear Support Vector Classification, a special class of <a class="reference external" href="https://scikit-learn.org/stable/auto_examples/svm/plot_separating_hyperplane.html#sphx-glr-auto-examples-svm-plot-separating-hyperplane-py">Support Vector Machines (SVM)</a>. SVMs are linear models that can be used for classification. They take data as input and try to find an ideal line to separate it into discrete classes. The LinearSCV does this using linear lines. So it can be applied when the kernel is assumed to be linear, meaning the data must be linearly separable. Furthermore, it  implements “one-vs-rest” multi-class strategy, thus training n_classes models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVC</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_predict</span>
<span class="n">est</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">()</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">cross_val_predict</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">connectome_vect</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">skf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/nwiltberg/miniconda3/envs/neuro_ai/lib/python3.7/site-packages/sklearn/model_selection/_split.py:680: UserWarning:

The least populated class in y has only 5 members, which is less than n_splits=10.
</pre></div>
</div>
</div>
</div>
<p>Let’s have a closer look at the predictions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 0, 0, 0, 3, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1,
       0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0])
</pre></div>
</div>
</div>
</div>
<p>Now, let’s evaluate the predictions made in each iteration. We will use <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_val_score.html">‘cross_val_score’</a> for this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="n">scores</span><span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">est</span><span class="p">,</span> <span class="n">connectome_vect</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.5  0.25 0.75 0.25 0.25 0.5  0.25 0.75 0.5  0.25]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/nwiltberg/miniconda3/envs/neuro_ai/lib/python3.7/site-packages/sklearn/model_selection/_split.py:680: UserWarning:

The least populated class in y has only 5 members, which is less than n_splits=10.
</pre></div>
</div>
</div>
</div>
<p>In the next step, the mean of the scores across all iterations is computed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.425
</pre></div>
</div>
</div>
</div>
<p>With 3 classes, the probability of guessing is around 0.33. The mean score is therefore slightly above the probability of guessing.</p>
</section>
<section id="unsupervised-learning-algorithm">
<h2>5. Unsupervised learning algorithm<a class="headerlink" href="#unsupervised-learning-algorithm" title="Permalink to this heading">#</a></h2>
<p>After using a supervised learning algorithm to predict the diagnosis, in the next steps an unsupervised learning algorithm will be used to cluster the data into distict groups that differ in connectivity between the considered networks.</p>
<p>In contrast to the procedure above, the algorithm here does not receive the diagnostic groups as input. Instead, the algorithm should only find systematic differences between the subjects based on the connectomes.</p>
<p>To do this, <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html#sklearn.cluster.KMeans">KMeans</a> will be used here. This is an algorithm that clusters data by trying to separate it in groups of equal variance and minimizing the within-cluster sum-of-squares. It requires the number of clusters to be separated. Here, it will be performed several times with differing numbers of clusters.</p>
<p>Furthermore, <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.silhouette_score.html">silhouette_score</a> will be used to compute the mean Silhouette Coefficient for each number of clusters. This function uses the mean intra-cluster distance and the mean nearest-cluster distance to calculate the coefficient.</p>
<p>To assess the stability of the silhouette scores, a cross-validation grid-search will be used for each cluster solution. The <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html">GridSearchCV</a> function will be used here.</p>
<p>First, the corresponding modules need to be imported.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">silhouette_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
</pre></div>
</div>
</div>
</div>
<p>Now, the <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_val_score.html">silhouette_score</a> described above is defined as scorer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scorer</span><span class="p">(</span><span class="n">clustering</span><span class="p">,</span> <span class="n">X_test</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">clustering</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now, the grid-search can be defined. Futhermore, KMeans is specified with a 10 time repetition on varying centroid seeds and the number of clusters will be set to 2, 3, 4, 5, 6 and 7. A ++ initiation is used here, which selects initial cluster centroids using sampling based on an empirical probability distribution of the points’ contribution to the overall inertia. Additionally, the scoring function is put in and the number of cross-validation folds is set to 10.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">KMeans</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="s1">&#39;k-means++&#39;</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="p">{</span><span class="s2">&quot;n_clusters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]},</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">scorer</span><span class="p">,</span>
    <span class="n">refit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">connectome_vect</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(40, 21)
</pre></div>
</div>
</div>
</div>
<p>At this point, the grid search can now be applied to the data, meaning the computed connectomes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">connectome_vect</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 10 folds for each of 6 candidates, totalling 60 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/nwiltberg/miniconda3/envs/neuro_ai/lib/python3.7/site-packages/sklearn/model_selection/_search.py:972: UserWarning:

One or more of the test scores are non-finite: [       nan 0.09703816 0.08756719        nan        nan        nan]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=10, estimator=KMeans(), n_jobs=5,
             param_grid={&#39;n_clusters&#39;: [2, 3, 4, 5, 6, 7]}, refit=False,
             scoring=&lt;function scorer at 0x7fd894284048&gt;, verbose=1)
</pre></div>
</div>
</div>
</div>
<p>The results of the grid-search can then be stored in a DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_splits</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">silhouette_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
<span class="n">silhouette_scores</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;param_n_clusters&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">silhouette_scores</span> <span class="o">=</span> <span class="n">silhouette_scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;split</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_test_score&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_splits</span><span class="p">)]]</span>
<span class="n">silhouette_scores</span> <span class="o">=</span> <span class="n">silhouette_scores</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;silhouette&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">silhouette_scores</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>param_n_clusters</th>
      <th>level_1</th>
      <th>silhouette</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>split0_test_score</td>
      <td>0.189484</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>split1_test_score</td>
      <td>0.046059</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>split3_test_score</td>
      <td>0.257097</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>split5_test_score</td>
      <td>0.047046</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>split7_test_score</td>
      <td>0.169016</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To get a better overview, an interactive plot will be created in the next few steps. The plotting function used was taken from this <a class="reference external" href="https://peerherholz.github.io/ns_ac_walkthrough/clustering.html#cluster-evaluation">website</a> and will plot the silhouette scores across cross-validation folds against the cluster solutions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">init_notebook_mode</span><span class="p">,</span> <span class="n">plot</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">iplot</span>




<span class="k">def</span> <span class="nf">plot_cluster_silhouette</span><span class="p">(</span><span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">interactive</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        
        <span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Arial&quot;</span>   

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;param_n_clusters&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;silhouette&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">silhouette_scores</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span><span class="c1">#, palette=sns.cubehelix_palette(15, start=-.2, rot=.6, reverse=True))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;param_n_clusters&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;silhouette&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">silhouette_scores</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;.25&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">artists</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cluster solution evaluation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;number of clusters&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;silhouette score&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tmp_df</span> <span class="ow">in</span> <span class="n">silhouette_scores</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;param_n_clusters&#39;</span><span class="p">):</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tmp_df</span><span class="p">[</span><span class="s1">&#39;silhouette&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">marker_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">boxpoints</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>    
            <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span> <span class="c1"># horizontal box plots   </span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s1">&#39;plotly_white&#39;</span><span class="p">,</span> 
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Silhouette score per cluster solution&quot;</span><span class="p">,</span> <span class="n">title_x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                          <span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
                          <span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;Silhouette score (across 10 folds)&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;Cluster solution (n clusters)&#39;</span><span class="p">,</span> <span class="n">tickvals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">16</span><span class="p">)))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
     
        <span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;/mnt/c/Users/nasta/Desktop/Forschungsmodul/project_msc05/data/silhouette_scores.html&#39;</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;plots/silhouette_scores.html&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_cluster_silhouette</span><span class="p">(</span><span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">        <script type="text/javascript">
        window.PlotlyConfig = {MathJaxConfig: 'local'};
        if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
        if (typeof require !== 'undefined') {
        require.undef("plotly");
        requirejs.config({
            paths: {
                'plotly': ['https://cdn.plot.ly/plotly-2.11.1.min']
            }
        });
        require(['plotly'], function(Plotly) {
            window._Plotly = Plotly;
        });
        }
        </script>
        </div><div class="output text_html">plots/silhouette_scores.html</div></div>
</div>
<p>The best value for the Silhouette Coefficient is 1 and the worst one is -1. If it is close to 0, this indicates that the clusters overlap. Three criteria now indicate which cluster solution best fits the data: the highest mean silhouette score across folds, the least variance across folds, and the least outliers. Taking these aspects into account, 2 clusters seem to be the most appropriate.</p>
</section>
<section id="more-data-from-brainlife">
<h2>6. More Data from brainlife<a class="headerlink" href="#more-data-from-brainlife" title="Permalink to this heading">#</a></h2>
<p>The steps described above were performed on a data set consisting of only 40 subjects. Moreover, these subjects are not equally distributed among the different diagnostic groups. As a consequence, the results obtained so far are hardly interpretable. For this reason, an attempt was made to load a larger sub-data set of the ADHD 200 sample using.</p>
<p>For this purpose, raw data of the <a class="reference external" href="http://datasets.datalad.org/adhd200/RawDataBIDS/NYU/">NYU subsample available on datalad</a> were imported to <span class="xref myst">brainlife</span>. On brainlife the data were preprocessed using the Configurable Pipeline for the Analysis of Connectomes (<a class="reference external" href="https://brainlife.io/app/5f3593e84615e04651bf9364">C-PAC</a>).</p>
<p>However, problems occurred when downloading the output files from brainlife. More information about this can be found in the open lab notebook. Overall, the attempt to obtain a larger data set failed.</p>
<p>The following code was used to try to download the data.</p>
<section id="load-authorization-token">
<h3>Load authorization token<a class="headerlink" href="#load-authorization-token" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">jwt_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/.config/brainlife.io/.jwt&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">jwt</span> <span class="o">=</span> <span class="n">jwt_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-object-ids">
<h3>Load object ids<a class="headerlink" href="#load-object-ids" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
bl data query --project 63808e678aec79ecaa916658 --datatype raw --datatype_tag c-pac --json | jq -r &#39;.[]._id&#39; &gt;&gt; object_ids.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">loadtxt</span>
<span class="n">object_ids</span> <span class="o">=</span> <span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;object_ids.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-subject-ids">
<h3>Load subject ids<a class="headerlink" href="#load-subject-ids" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
bl data query --project 63808e678aec79ecaa916658 --datatype raw --datatype_tag c-pac --json | jq -r &#39;.[].meta.subject&#39; &gt;&gt; subject_ids.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subject_ids</span> <span class="o">=</span> <span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;subject_ids.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="link-object-and-subject-ids">
<h3>Link object and subject ids<a class="headerlink" href="#link-object-and-subject-ids" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="k">for</span> <span class="n">sub</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">subject_ids</span><span class="p">,</span> <span class="n">object_ids</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="attempt-to-load-file-for-one-subject">
<h3>Attempt to load file for one subject<a class="headerlink" href="#attempt-to-load-file-for-one-subject" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">auth_str</span> <span class="o">=</span> <span class="s2">&quot;Authorization: Bearer &quot;</span> <span class="o">+</span> <span class="n">jwt</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;https://brainlife.io/api/warehouse/dataset/download/subset/63931e0590d3e7dd30c039a6/output/cpac_cpac-default-pipeline/sub-0010106_ses-1/func/sub-0010106_ses-1_task-rest_run-1_atlas-Yeo-7-liberalspace-MNI152NLin6res-1x1x1_desc-ndmg-2_correlations.csv&quot;</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s2">&quot;/mnt/c/Users/nasta/Desktop/sub-0010106_ses-1_task-rest_run-1_atlas-Yeo-7-liberalspace-MNI152NLin6res-1x1x1_desc-ndmg-2_correlations.csv&quot;</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;curl&quot;</span><span class="p">,</span> <span class="s2">&quot;-H&quot;</span><span class="p">,</span> <span class="n">auth_str</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "neuro_ai"
        },
        kernelOptions: {
            name: "neuro_ai",
            path: "./code"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'neuro_ai'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Data_Exploration.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Data Exploration</p>
      </div>
    </a>
    <a class="right-next"
       href="Discussion.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Evaluation and Discussion of the Results</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-data">0. Recap Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-time-series">1. Extracting time series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-and-display-correlation-matrix-for-one-participant">2. Compute and display correlation matrix for one participant</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-time-series-and-compute-connectome-for-all-participants">3. Extract time series and compute connectome for all participants</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supervised-learning-algorithm">4. Supervised learning algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unsupervised-learning-algorithm">5. Unsupervised learning algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#more-data-from-brainlife">6. More Data from brainlife</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-authorization-token">Load authorization token</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-object-ids">Load object ids</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-subject-ids">Load subject ids</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#link-object-and-subject-ids">Link object and subject ids</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attempt-to-load-file-for-one-subject">Attempt to load file for one subject</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Nastasja von Wiltberg
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>